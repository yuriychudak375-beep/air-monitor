<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–ê–¥–º—ñ–Ω ‚Äî WS —Ä–µ–∂–∏–º</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    /* ===================================
       –¢–ï–ú–ò (CSS –∑–º—ñ–Ω–Ω—ñ)
       =================================== */
    :root {
      --bg: #111;
      --panel-bg: #181818;
      --text: #eee;
      --input-bg: #222;
      --input-border: #555;
    }
    .light {
      --bg: #f5f5f5;
      --panel-bg: #fff;
      --text: #000;
      --input-bg: #eee;
      --input-border: #ccc;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    /* ===================================
       –¢–æ–ø –±–∞—Ä (–ø–µ—Ä–µ–º–∏–∫–∞—á —Ç–µ–º–∏)
       =================================== */
    #themeBar {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 40px;
      background: var(--panel-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      border-bottom: 1px solid var(--input-border);
    }

    #themeToggle {
      background: var(--input-bg);
      color: var(--text);
      border: 1px solid var(--input-border);
      padding: 5px 15px;
      border-radius: 6px;
      cursor: pointer;
    }

    /* ===================================
       –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
       =================================== */
    #wrap {
      display: flex;
      margin-top: 40px; /* –±–æ top-bar 40px */
      height: calc(100vh - 40px);
      width: 100vw;
    }

    #map {
      width: 70vw;
      height: 100%;
    }

    /* ===================================
       –ü—Ä–∞–≤ –ø–∞–Ω–µ–ª—å
       =================================== */
    #panel {
      width: 30vw;
      padding: 10px;
      background: var(--panel-bg);
      border-left: 1px solid var(--input-border);
      overflow-y: auto;
    }

    input, select, button {
      width: 100%;
      padding: 7px;
      margin-top: 8px;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      color: var(--text);
      border-radius: 6px;
    }

    button {
      cursor: pointer;
    }

    .target-item {
      border: 1px solid var(--input-border);
      padding: 8px;
      margin-bottom: 6px;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <!-- =======================
       TOP BAR
       ======================= -->
  <div id="themeBar">
    <button id="themeToggle">üåû –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞</button>
  </div>

  <!-- =======================
       –û—Å–Ω–æ–≤–Ω–∏–π –º–∞–∫–µ—Ç
       ======================= -->
  <div id="wrap">
    <div id="map"></div>

    <div id="panel">
      <h3>–î–æ–¥–∞—Ç–∏ —Ü—ñ–ª—å</h3>

      <label>–¢–∏–ø</label>
      <select id="type">
        <option value="x101">–•-101</option>
        <option value="shahed">Shahed-136</option>
        <option value="iskander">–Ü—Å–∫–∞–Ω–¥–µ—Ä</option>
        <option value="kalibr">–ö–∞–ª—ñ–±—Ä</option>
      </select>

      <label>Lat / Lon (–∫–ª—ñ–∫ –ø–æ –∫–∞—Ä—Ç—ñ)</label>
      <input id="lat" placeholder="–®–∏—Ä–æ—Ç–∞">
      <input id="lon" placeholder="–î–æ–≤–≥–æ—Ç–∞">

      <label>–ù–∞–ø—Ä—è–º–æ–∫</label>
      <select id="dir">
        <option value="N">–ü—ñ–≤–Ω—ñ—á</option>
        <option value="NE">–ü–Ω-–°—Ö</option>
        <option value="E">–°—Ö—ñ–¥</option>
        <option value="SE">–ü–¥-–°—Ö</option>
        <option value="S">–ü—ñ–≤–¥–µ–Ω—å</option>
        <option value="SW">–ü–¥-–ó—Ö</option>
        <option value="W">–ó–∞—Ö—ñ–¥</option>
        <option value="NW">–ü–Ω-–ó—Ö</option>
      </select>

      <label>–®–≤–∏–¥–∫—ñ—Å—Ç—å</label>
      <input id="speed" value="0.0003">

      <button id="addBtn">–î–æ–¥–∞—Ç–∏</button>
      <button id="clearBtn">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ</button>

      <h3>–°–ø–∏—Å–æ–∫</h3>
      <div id="list"></div>
    </div>
  </div>


  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    /* ============================================
       –ö–ê–†–¢–ê
       ============================================ */
    const map = L.map("map").setView([49, 31], 6);
    L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

    map.on("click", e => {
      lat.value = e.latlng.lat.toFixed(5);
      lon.value = e.latlng.lng.toFixed(5);
    });

    /* ============================================
       –í–ï–ö–¢–û–†–ò —Ä—É—Ö—É
       ============================================ */
    function dirToVector(dir) {
      switch (dir) {
        case "N":  return { dx: 0, dy: 0.02 };
        case "NE": return { dx: 0.02, dy: 0.02 };
        case "E":  return { dx: 0.02, dy: 0 };
        case "SE": return { dx: 0.02, dy: -0.02 };
        case "S":  return { dx: 0, dy: -0.02 };
        case "SW": return { dx: -0.02, dy: -0.02 };
        case "W":  return { dx: -0.02, dy: 0 };
        case "NW": return { dx: -0.02, dy: 0.02 };
      }
    }

    /* ============================================
       WS
       ============================================ */
    const ws = new WebSocket(
    (location.protocol === "https:" ? "wss://" : "ws://") + location.host
);

    let currentTargets = [];

    ws.onmessage = ev => {
      const data = JSON.parse(ev.data);
      if (data.type === "state") {
        currentTargets = data.targets;
        renderList();
      }
    };

    function send(o) {
      ws.send(JSON.stringify(o));
    }

    /* ============================================
       –î–û–î–ê–¢–ò —Ü—ñ–ª—å
       ============================================ */
    addBtn.onclick = () => {
      if (!lat.value || !lon.value) {
        alert("–ö–ª—ñ–∫–Ω–∏ –Ω–∞ –∫–∞—Ä—Ç—É!");
        return;
      }

      const { dx, dy } = dirToVector(dir.value);

      send({
        role: "admin",
        action: "add",
        target: {
          type: type.value,
          lat: +lat.value,
          lon: +lon.value,
          dx, dy,
          speed: +speed.value
        }
      });
    };

    clearBtn.onclick = () => {
      send({ role: "admin", action: "clear" });
    };

    /* ============================================
       –°–ü–ò–°–û–ö
       ============================================ */
    function renderList() {
      list.innerHTML = "";

      currentTargets.forEach(t => {
        const div = document.createElement("div");
        div.className = "target-item";
        div.innerHTML = `
          <b>${t.type}</b><br>
          ID: ${t.id}<br>
          Lat: ${t.lat.toFixed(3)}, Lon: ${t.lon.toFixed(3)}<br>
          <button data-id="${t.id}" class="del">–í–∏–¥–∞–ª–∏—Ç–∏</button>
        `;
        list.appendChild(div);
      });

      document.querySelectorAll(".del").forEach(btn => {
        btn.onclick = () => {
          send({ role: "admin", action: "remove", id: btn.dataset.id });
        };
      });
    }

    /* ============================================
       –¢–ï–ú–ê
       ============================================ */
    const btn = document.getElementById("themeToggle");

    btn.onclick = () => {
      document.body.classList.toggle("light");

      if (document.body.classList.contains("light")) {
        btn.textContent = "üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞";
      } else {
        btn.textContent = "üåû –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞";
      }
    };
  </script>
</body>
</html>






